<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stargazing</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-61M5LTFQB7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-61M5LTFQB7');
    </script>
    <script src="https://unpkg.com/astronomy-engine@latest/astronomy.browser.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #0f172a;
            /* Dark blue/slate background */
            color: #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
            padding: 1rem;
        }

        .container {
            padding: 2rem;
            background: #1e293b;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            max-width: 500px;
            width: 100%;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #38bdf8;
            /* Light blue */
        }

        h2 {
            font-size: 1.2rem;
            color: #94a3b8;
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #334155;
            padding-bottom: 0.5rem;
        }

        .time-box {
            background: #334155;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .time-label {
            font-size: 0.875rem;
            color: #94a3b8;
            margin-bottom: 0.25rem;
        }

        .time-value {
            font-size: 1.5rem;
            font-weight: bold;
            font-variant-numeric: tabular-nums;
        }

        .data-section {
            margin-top: 1.5rem;
            border-top: 1px solid #334155;
            padding-top: 1.5rem;
        }

        .btn {
            background: #38bdf8;
            color: #0f172a;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #0ea5e9;
        }

        .hidden {
            display: none;
        }

        .solar-event {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            /* Changed to align-start for multiline */
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #1e293b;
            flex-wrap: wrap;
            /* Allow wrapping */
        }

        .solar-value-container {
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .solar-label {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .bedic-time-range {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 2px;
        }

        /* Custom Tooltip */
        .tooltip-container {
            position: relative;
            cursor: help;
            border-bottom: 1px dotted #94a3b8;
        }

        .tooltip-container:hover::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #334155;
            color: #fff;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 10;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 5px;
        }

        .vedic-progress-bg {
            width: 100px;
            height: 4px;
            background: #334155;
            border-radius: 2px;
            margin-top: 4px;
            overflow: hidden;
        }

        .vedic-progress-fill {
            height: 100%;
            background: #38bdf8;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .vedic-header-date {
            text-align: center;
            font-size: 0.9rem;
            color: #94a3b8;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px dashed #334155;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, minmax(110px, auto));
            /* Taller rows */
            gap: 2px;
            background: #334155;
            /* Border color */
            margin-top: 1rem;
            border: 2px solid #334155;
            font-size: 0.85rem;
        }

        .chart-cell {
            background: #1e293b;
            padding: 6px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .chart-cell-label {
            font-size: 0.7rem;
            color: #94a3b8;
            margin-bottom: 4px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }

        .chart-planets {
            display: flex;
            flex-direction: column;
            /* Stack planets vertically */
            gap: 2px;
            align-content: center;
        }

        .planet-icon {
            font-size: 1rem;
            /* Larger icon */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        /* Center hole */
        .chart-center {
            grid-column: 2 / span 2;
            grid-row: 2 / span 2;
            background: #1e293b;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: #64748b;
            text-align: center;
            padding: 1rem;
        }

        /* Specific positions for South Indian Chart (Pisces top-left, clockwise) */
        /*
        12 1 2 3
        11     4
        10     5
        9  8 7 6
        Note: Indices 0..11 where 0=Aries. 
        Pisces=11, Aries=0, Taurus=1, Gemini=2
        */
        .sign-11 {
            grid-area: 1 / 1 / 2 / 2;
        }

        /* Pisces */
        .sign-0 {
            grid-area: 1 / 2 / 2 / 3;
        }

        /* Aries */
        .sign-1 {
            grid-area: 1 / 3 / 2 / 4;
        }

        /* Taurus */
        .sign-2 {
            grid-area: 1 / 4 / 2 / 5;
        }

        /* Gemini */

        .sign-3 {
            grid-area: 2 / 4 / 3 / 5;
        }

        /* Cancer */
        .sign-4 {
            grid-area: 3 / 4 / 4 / 5;
        }

        /* Leo */

        .sign-5 {
            grid-area: 4 / 4 / 5 / 5;
        }

        /* Virgo */
        .sign-6 {
            grid-area: 4 / 3 / 5 / 4;
        }

        /* Libra */
        .sign-7 {
            grid-area: 4 / 2 / 5 / 3;
        }

        /* Scorpio */
        .sign-8 {
            grid-area: 4 / 1 / 5 / 2;
        }

        /* Sagittarius */

        .sign-9 {
            grid-area: 3 / 1 / 4 / 2;
        }

        /* Capricorn */
        .sign-10 {
            grid-area: 2 / 1 / 3 / 2;
        }

        /* Aquarius */
    </style>
</head>

<body>
    <div class="container">
        <h1>Stargazing</h1>

        <div class="time-box">
            <div class="time-label">Current UTC Time</div>
            <div id="utc-time" class="time-value">Loading...</div>
            <div class="time-label" style="margin-top: 1rem;">Local System Time</div>
            <div id="local-time" class="time-value">Loading...</div>
        </div>

        <div id="initial-state">
            <p style="margin-bottom: 1.5rem; color: #cbd5e1;">Detecting location...</p>
            <button id="locate-btn" class="btn">Use Precise Location</button>
        </div>

        <div id="loading-state" class="hidden">
            <p>Scanning the cosmos...</p>
        </div>

        <div id="data-state" class="hidden data-section">
            <div style="margin-bottom: 1rem; font-size: 0.9rem; color: #94a3b8;">
                Coordinates: <span id="location-coords"></span>
            </div>
            <div id="location-name-container"
                style="margin-bottom: 1rem; font-size: 1.1rem; color: #38bdf8; font-weight: 500;">
                <span id="location-name"></span>
            </div>

            <div class="solar-event">
                <span class="solar-label">‚òÄÔ∏è <span id="label-sun-cycle">Sun</span></span>
                <div class="solar-value-container">
                    <span id="sun-next-event-time">--:--</span>
                    <div class="vedic-progress-bg" title="Sun Cycle Progress">
                        <div id="progress-sun" class="vedic-progress-fill" style="width:0%"></div>
                    </div>
                    <span id="sun-cycle-range" class="bedic-time-range">--</span>
                </div>
            </div>

            <div class="solar-event">
                <span class="solar-label">üåô <span id="label-moon-cycle">Moon</span></span>
                <div class="solar-value-container">
                    <span id="moon-next-event-time">--:--</span>
                    <div class="vedic-progress-bg" title="Moon Cycle Progress">
                        <div id="progress-moon" class="vedic-progress-fill" style="width:0%"></div>
                    </div>
                    <span id="moon-cycle-range" class="bedic-time-range">--</span>
                </div>
            </div>

            <div class="solar-event">
                <span class="solar-label">ÔøΩ Moon Phase</span>
                <div class="solar-value-container">
                    <span id="moon-phase-name">--</span>
                    <div class="vedic-progress-bg" title="Lunar Phase Progress">
                        <div id="progress-phase" class="vedic-progress-fill" style="width:0%"></div>
                    </div>
                    <span id="moon-phase-range" class="bedic-time-range">--</span>
                </div>
            </div>
        </div>

        <div id="vedic-data" class="hidden data-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem;">
                <h2 style="margin:0; border-bottom:0; color:#38bdf8; font-size:1.1rem;">Vedic Calendar</h2>
                <select id="vedic-lang-select"
                    style="background:#0f172a; color:#cbd5e1; border:1px solid #334155; border-radius:4px; padding:2px 5px; font-size:0.8rem;">
                    <option value="en">English</option>
                    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
                    <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bangla)</option>
                    <option value="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü (Odia)</option>
                    <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
                </select>
            </div>

            <div id="vedic-date-header" class="vedic-header-date">
                <!-- Hindu Date will be injected here -->
            </div>

            <div class="solar-event">
                <span id="label-tithi" class="solar-label tooltip-container" data-tip="Lunar Day (1/30th of Month)">üìÖ
                    Tithi</span>
                <div class="solar-value-container">
                    <span id="vedic-tithi">--</span>
                    <div class="vedic-progress-bg" title="Progress to next Tithi">
                        <div id="progress-tithi" class="vedic-progress-fill" style="width:0%"></div>
                    </div>
                    <span id="vedic-tithi-end" class="bedic-time-range"></span>
                </div>
            </div>
            <div class="solar-event">
                <span id="label-nakshatra" class="solar-label">‚ú® Nakshatra</span>
                <div class="solar-value-container">
                    <span id="vedic-nakshatra" class="tooltip-container" data-tip="Lunar Mansion">--</span>
                    <div class="vedic-progress-bg" title="Progress to next Nakshatra">
                        <div id="progress-nakshatra" class="vedic-progress-fill" style="width:0%"></div>
                    </div>
                    <span id="vedic-nakshatra-end" class="bedic-time-range"></span>
                </div>
            </div>

            <div class="solar-event">
                <span id="label-moon-rashi" class="solar-label tooltip-container"
                    data-tip="Moon Sign (Chandra Rashi)">üåí Chandra Rashi</span>
                <div class="solar-value-container">
                    <span id="vedic-moon-rashi">--</span>
                    <div class="vedic-progress-bg" title="Progress of Moon through Sign">
                        <div id="progress-moon-rashi" class="vedic-progress-fill" style="width:0%"></div>
                    </div>
                    <span id="vedic-moon-rashi-end" class="bedic-time-range"></span>
                </div>
            </div>

            <div class="solar-event">
                <span id="label-sun-rashi" class="solar-label tooltip-container" data-tip="Sun Sign (Surya Rashi)">‚òÄÔ∏è
                    Surya Rashi</span>
                <div class="solar-value-container">
                    <span id="vedic-sun-rashi">--</span>
                    <div class="vedic-progress-bg" title="Progress of Sun through Sign">
                        <div id="progress-sun-rashi" class="vedic-progress-fill" style="width:0%"></div>
                    </div>
                    <span id="vedic-sun-rashi-end" class="bedic-time-range"></span>
                </div>
            </div>

            <div class="solar-event">
                <span id="label-masa" class="solar-label tooltip-container" data-tip="Lunar Month (Amanta)">üóìÔ∏è
                    Lunar Masa</span>
                <div class="solar-value-container">
                    <span id="vedic-masa">--</span>
                    <!-- Progress of Month? Approx Tithi/30 -->
                    <div class="vedic-progress-bg" title="Progress of Lunar Month">
                        <div id="progress-masa" class="vedic-progress-fill" style="width:0%"></div>
                    </div>
                    <span id="vedic-masa-end" class="bedic-time-range"></span>
                </div>
            </div>

            <div class="solar-event">
                <span id="label-vaara" class="solar-label tooltip-container"
                    data-tip="Day of the Week (Sunrise-based)">üìÜ Vaara</span>
                <div class="solar-value-container">
                    <span id="vedic-vaara">--</span>
                    <!-- Progress of Day 24h -->
                    <div class="vedic-progress-bg" title="Progress of Solar Day (Sunrise to Sunrise)">
                        <div id="progress-vaara" class="vedic-progress-fill" style="width:0%"></div>
                    </div>
                    <span id="vedic-vaara-end" class="bedic-time-range"></span>
                </div>
            </div>
            <div class="solar-event">
                <span id="label-paksha" class="solar-label tooltip-container"
                    data-tip="Lunar Fortnight (Waxing/Waning)">üåó Paksha</span>
                <div class="solar-value-container">
                    <span id="vedic-paksha">--</span>
                    <div class="vedic-progress-bg" title="Progress of Paksha (15 Tithis)">
                        <div id="progress-paksha" class="vedic-progress-fill" style="width:0%"></div>
                    </div>
                    <span id="vedic-paksha-end" class="bedic-time-range"></span>
                </div>
            </div>

            <div class="solar-event">
                <span id="label-prahara" class="solar-label tooltip-container"
                    data-tip="3-hour time division of Day/Night">‚è≥ Prahara</span>
                <div class="solar-value-container">
                    <span id="vedic-prahara">--</span>
                    <div class="vedic-progress-bg" title="Progress of Prahara">
                        <div id="progress-prahara" class="vedic-progress-fill" style="width:0%"></div>
                    </div>
                    <span id="vedic-prahara-end" class="bedic-time-range"></span>
                </div>
            </div>
        </div>

        <div id="planetary-data" class="hidden data-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h2 style="margin:0; border-bottom:0; color:#38bdf8; font-size:1.1rem;">Planetary Positions</h2>
            </div>
            <div id="planet-list"></div>
        </div>

        <div id="error-msg" class="hidden"></div>

        <div class="external-links"
            style="margin-top: 2rem; border-top: 1px solid #334155; padding-top: 1rem; font-size: 0.9rem;">
            <div id="skymap-container"
                style="width: 100%; height: 350px; border-radius: 8px; overflow: hidden; margin-top: 1rem;">
                <!-- VirtualSky iframe will be injected here -->
            </div>
            Powered by <a href="https://lco.global/spacebook/sky-map/" target="_blank" style="color: #64748b;">LCO
                VirtualSky</a>
        </div>
        <div style="margin-top: 1rem; border-top: 1px dotted #334155; padding-top: 0.5rem;">
            <a id="ha-link" href="#" target="_blank"
                style="color: #38bdf8; text-decoration: none; border-bottom: 1px dotted #38bdf8;">View Sky Chart on
                Heavens-Above</a>
        </div>
    </div>
    </div>

    <script>
        // Update clock every second
        function updateClock() {
            const now = new Date();

            // Helper to format as: Fri, 02 Jan 26
            const formatTime = (date, isUTC) => {
                const pad = (n) => n.toString().padStart(2, '0');

                // Day of week
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const dayName = isUTC ? days[date.getUTCDay()] : days[date.getDay()];

                // Month names (3-letter)
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const monthName = isUTC ? months[date.getUTCMonth()] : months[date.getMonth()];

                const year = isUTC ? date.getUTCFullYear().toString().slice(-2) : date.getFullYear().toString().slice(-2);
                const day = pad(isUTC ? date.getUTCDate() : date.getDate());

                const hours = pad(isUTC ? date.getUTCHours() : date.getHours());
                const minutes = pad(isUTC ? date.getUTCMinutes() : date.getUTCSeconds());
                const seconds = pad(isUTC ? date.getUTCSeconds() : date.getSeconds());

                return `${dayName}, ${day} ${monthName} ${year} ${hours}:${minutes}:${seconds}`;
            };

            document.getElementById('utc-time').innerText = formatTime(now, true) + ' UTC';

            // Get local timezone abbreviation if possible
            let tzName = '';
            try {
                // Try to get short timezone name (e.g. PST, IST, EST)
                tzName = new Date().toLocaleTimeString('en-us', { timeZoneName: 'short' }).split(' ').pop();
                // If it's something like "GMT+5:30", we keep it. 
                // Sometimes it might return just "PM" if split fails or format is different, so let's be careful.
                const parts = new Intl.DateTimeFormat('en-US', { timeZoneName: 'short' }).formatToParts(now);
                const tzPart = parts.find(p => p.type === 'timeZoneName');
                if (tzPart) tzName = tzPart.value;
            } catch (e) {
                tzName = 'Local';
            }

            document.getElementById('local-time').innerText = formatTime(now, false) + ' ' + tzName;
        }
        setInterval(updateClock, 1000);
        updateClock();

        const locateBtn = document.getElementById('locate-btn');
        const initialState = document.getElementById('initial-state');
        const loadingState = document.getElementById('loading-state');
        const dataState = document.getElementById('data-state');
        const errorMsg = document.getElementById('error-msg');

        let currentLang = localStorage.getItem('vedic-lang') || 'en';
        document.getElementById('vedic-lang-select').value = currentLang;

        document.getElementById('vedic-lang-select').addEventListener('change', (e) => {
            currentLang = e.target.value;
            localStorage.setItem('vedic-lang', currentLang);

            // Re-render if we have data
            if (!dataState.classList.contains('hidden')) {
                // We need the last used date/loc. 
                // Since this is a simple app, we can just re-trigger with current "Now" and last known loc.
                // Or better, let the update loop handle it? No, updateClock handles time, but vedic is static.
                // We'll re-run updateVedicDetails with current "Now" and last known loc.
                if (window.lastLat && window.lastLng) {
                    updateVedicDetails(new Date(), window.lastLat, window.lastLng);
                }
            }
        });

        // Auto-detect location on load
        window.addEventListener('load', () => {
            fetchIPLocation();
        });

        locateBtn.addEventListener('click', () => {
            if (!navigator.geolocation) {
                showError("Geolocation is not supported by your browser.");
                return;
            }

            initialState.classList.add('hidden');
            loadingState.classList.remove('hidden');
            dataState.classList.add('hidden'); // Hide data while re-fetching

            getLoc(true);
        });

        async function fetchIPLocation() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();

                if (data.latitude && data.longitude) {
                    success({
                        coords: {
                            latitude: data.latitude,
                            longitude: data.longitude
                        }
                    }, false); // Pass false to indicate this is not precise location
                } else {
                    throw new Error("Invalid IP data");
                }
            } catch (e) {
                console.warn("IP Location failed:", e);
                // Don't show error to user, just stay on initial state waiting for manual click
            }
        }

        function getLoc(highAccuracy) {
            navigator.geolocation.getCurrentPosition(
                (pos) => success(pos, true),
                (err) => {
                    if (highAccuracy) {
                        console.log("High accuracy failed, retrying with low accuracy...");
                        getLoc(false);
                    } else {
                        error(err);
                    }
                },
                {
                    enableHighAccuracy: highAccuracy,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        function success(position, isPrecise) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            window.lastLat = lat;
            window.lastLng = lng;

            document.getElementById('location-coords').innerText =
                `${lat.toFixed(4)}, ${lng.toFixed(4)}` + (isPrecise ? " (GPS)" : " (IP)");

            fetchLocationName(lat, lng);
            const now = new Date();

            // Update UI
            initialState.classList.add('hidden');
            loadingState.classList.add('hidden');
            dataState.classList.remove('hidden');

            // Ensure Astronomy is ready
            if (typeof Astronomy !== 'undefined') {
                updateSolarLunarCycles(now, lat, lng);
            } else {
                setTimeout(() => {
                    if (typeof Astronomy !== 'undefined') {
                        updateSolarLunarCycles(now, lat, lng);
                    }
                }, 500);
            }

            updateVedicDetails(now, lat, lng);
            updatePlanetaryPositions(now);
            updateExternalLinks(lat, lng);
        }

        const NAKSHATRA_DATA = [
            { name: "Ashwini", star: "Beta Arietis (Sheratan)", con: "Aries", mag: "2.64", dist: "59.6 ly" },
            { name: "Bharani", star: "41 Arietis", con: "Aries", mag: "3.61", dist: "160 ly" },
            { name: "Krittika", star: "Eta Tauri (Alcyone)", con: "Taurus", mag: "2.85", dist: "440 ly" },
            { name: "Rohini", star: "Alpha Tauri (Aldebaran)", con: "Taurus", mag: "0.87", dist: "65 ly" },
            { name: "Mrigashirsha", star: "Lambda Orionis (Meissa)", con: "Orion", mag: "3.39", dist: "1055 ly" },
            { name: "Ardra", star: "Alpha Orionis (Betelgeuse)", con: "Orion", mag: "0.50 (var)", dist: "640 ly" },
            { name: "Punarvasu", star: "Beta Geminorum (Pollux)", con: "Gemini", mag: "1.14", dist: "33.7 ly" },
            { name: "Pushya", star: "Delta Cancri (Asellus Australis)", con: "Cancer", mag: "3.94", dist: "180 ly" },
            { name: "Ashlesha", star: "Epsilon Hydrae", con: "Hydra", mag: "3.38", dist: "129 ly" },
            { name: "Magha", star: "Alpha Leonis (Regulus)", con: "Leo", mag: "1.40", dist: "79 ly" },
            { name: "Purva Phalguni", star: "Delta Leonis (Zosma)", con: "Leo", mag: "2.56", dist: "57.7 ly" },
            { name: "Uttara Phalguni", star: "Beta Leonis (Denebola)", con: "Leo", mag: "2.11", dist: "35.9 ly" },
            { name: "Hasta", star: "Delta Corvi (Algorab)", con: "Corvus", mag: "2.95", dist: "86.9 ly" },
            { name: "Chitra", star: "Alpha Virginis (Spica)", con: "Virgo", mag: "0.98", dist: "250 ly" },
            { name: "Swati", star: "Alpha Bootis (Arcturus)", con: "Bootes", mag: "-0.05", dist: "36.7 ly" },
            { name: "Vishakha", star: "Alpha Librae (Zubenelgenubi)", con: "Libra", mag: "2.75", dist: "74.9 ly" },
            { name: "Anuradha", star: "Delta Scorpii (Dschubba)", con: "Scorpius", mag: "2.32", dist: "490 ly" },
            { name: "Jyeshtha", star: "Alpha Scorpii (Antares)", con: "Scorpius", mag: "1.06 (var)", dist: "550 ly" },
            { name: "Mula", star: "Lambda Scorpii (Shaula)", con: "Scorpius", mag: "1.62", dist: "365 ly" },
            { name: "Purva Ashadha", star: "Delta Sagittarii (Kaus Media)", con: "Sagittarius", mag: "2.70", dist: "348 ly" },
            { name: "Uttara Ashadha", star: "Sigma Sagittarii (Nunki)", con: "Sagittarius", mag: "2.05", dist: "228 ly" },
            { name: "Shravana", star: "Alpha Aquilae (Altair)", con: "Aquila", mag: "0.77", dist: "16.7 ly" },
            { name: "Dhanishta", star: "Beta Delphini (Rotanev)", con: "Delphinus", mag: "3.63", dist: "100 ly" },
            { name: "Shatabhisha", star: "Gamma Aquarii (Sadachbia)", con: "Aquarius", mag: "3.84", dist: "164 ly" },
            { name: "Purva Bhadrapada", star: "Alpha Pegasi (Markab)", con: "Pegasus", mag: "2.48", dist: "133 ly" },
            { name: "Uttara Bhadrapada", star: "Gamma Pegasi (Algenib)", con: "Pegasus", mag: "2.84", dist: "390 ly" },
            { name: "Revati", star: "Zeta Piscium", con: "Pisces", mag: "5.2", dist: "148 ly" }
        ];

        const VEDIC_TRANSLATIONS = {
            en: {
                labels: { tithi: "üìÖ Tithi", masa: "üóìÔ∏è Lunar Month", rashi: "‚òÄÔ∏è Surya Rashi", moonRashi: "üåí Chandra Rashi", vaara: "üìÜ Vaara", paksha: "üåó Paksha", nakshatra: "‚ú® Nakshatra", prahara: "‚è≥ Prahara" },
                tithi: ["Prathama", "Dwitiya", "Tritiya", "Chaturthi", "Panchami", "Shashthi", "Saptami", "Ashtami", "Navami", "Dashami", "Ekadashi", "Dwadashi", "Trayodashi", "Chaturdashi", "Purnima", "Amavasya"],
                paksha: ["Shukla (Waxing)", "Krishna (Waning)"],
                nakshatra: ["Ashwini", "Bharani", "Krittika", "Rohini", "Mrigashirsha", "Ardra", "Punarvasu", "Pushya", "Ashlesha", "Magha", "Purva Phalguni", "Uttara Phalguni", "Hasta", "Chitra", "Swati", "Vishakha", "Anuradha", "Jyeshtha", "Mula", "Purva Ashadha", "Uttara Ashadha", "Shravana", "Dhanishta", "Shatabhisha", "Purva Bhadrapada", "Uttara Bhadrapada", "Revati"],
                rashi: ["‚ôà Mesha", "‚ôâ Vrishabha", "‚ôä Mithuna", "‚ôã Karka", "‚ôå Simha", "‚ôç Kanya", "‚ôé Tula", "‚ôè Vrishchika", "‚ôê Dhanu", "‚ôë Makara", "‚ôí Kumbha", "‚ôì Meena"],
                masaName: ["Baishakha", "Jyeshtha", "Ashadha", "Shravana", "Bhadrapada", "Ashwina", "Kartika", "Margashirsha", "Pausha", "Magha", "Phalguna", "Chaitra"],
                vaara: ["Ravivara (Sun)", "Somavara (Mon)", "Mangalavara (Tue)", "Budhavara (Wed)", "Guruvara (Thu)", "Shukravara (Fri)", "Shanivara (Sat)"],
                prahara: ["Day Prahara", "Night Prahara"],
                eras: { vikram: "Vikram Samvat", shaka: "Shaka Samvat", bangla: "Bangabda" }
            },
            hi: {
                labels: { tithi: "üìÖ ‡§§‡§ø‡§•‡§ø", masa: "üóìÔ∏è ‡§ö‡§Ç‡§¶‡•ç‡§∞ ‡§Æ‡§æ‡§∏", rashi: "‚òÄÔ∏è ‡§∏‡•Ç‡§∞‡•ç‡§Ø ‡§∞‡§æ‡§∂‡§ø", moonRashi: "üåí ‡§ö‡§Ç‡§¶‡•ç‡§∞ ‡§∞‡§æ‡§∂‡§ø", vaara: "üìÜ ‡§µ‡§æ‡§∞", paksha: "üåó ‡§™‡§ï‡•ç‡§∑", nakshatra: "‚ú® ‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞", prahara: "‚è≥ ‡§™‡•ç‡§∞‡§π‡§∞" },
                tithi: ["‡§™‡•ç‡§∞‡§•‡§Æ‡§æ", "‡§¶‡•ç‡§µ‡§ø‡§§‡•Ä‡§Ø‡§æ", "‡§§‡•É‡§§‡•Ä‡§Ø‡§æ", "‡§ö‡§§‡•Å‡§∞‡•ç‡§•‡•Ä", "‡§™‡§Ç‡§ö‡§Æ‡•Ä", "‡§∑‡§∑‡•ç‡§†‡•Ä", "‡§∏‡§™‡•ç‡§§‡§Æ‡•Ä", "‡§Ö‡§∑‡•ç‡§ü‡§Æ‡•Ä", "‡§®‡§µ‡§Æ‡•Ä", "‡§¶‡§∂‡§Æ‡•Ä", "‡§è‡§ï‡§æ‡§¶‡§∂‡•Ä", "‡§¶‡•ç‡§µ‡§æ‡§¶‡§∂‡•Ä", "‡§§‡•ç‡§∞‡§Ø‡•ã‡§¶‡§∂‡•Ä", "‡§ö‡§§‡•Å‡§∞‡•ç‡§¶‡§∂‡•Ä", "‡§™‡•Ç‡§∞‡•ç‡§£‡§ø‡§Æ‡§æ", "‡§Ö‡§Æ‡§æ‡§µ‡§∏‡•ç‡§Ø‡§æ"],
                paksha: ["‡§∂‡•Å‡§ï‡•ç‡§≤ ‡§™‡§ï‡•ç‡§∑", "‡§ï‡•É‡§∑‡•ç‡§£ ‡§™‡§ï‡•ç‡§∑"],
                nakshatra: ["‡§Ö‡§∂‡•ç‡§µ‡§ø‡§®‡•Ä", "‡§≠‡§∞‡§£‡•Ä", "‡§ï‡•É‡§§‡•ç‡§§‡§ø‡§ï‡§æ", "‡§∞‡•ã‡§π‡§ø‡§£‡•Ä", "‡§Æ‡•É‡§ó‡§∂‡•Ä‡§∞‡•ç‡§∑", "‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§æ", "‡§™‡•Å‡§®‡§∞‡•ç‡§µ‡§∏‡•Å", "‡§™‡•Å‡§∑‡•ç‡§Ø", "‡§Ö‡§∂‡•ç‡§≤‡•á‡§∑‡§æ", "‡§Æ‡§ò‡§æ", "‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ ‡§´‡§æ‡§≤‡•ç‡§ó‡•Å‡§®‡•Ä", "‡§â‡§§‡•ç‡§§‡§∞‡§æ ‡§´‡§æ‡§≤‡•ç‡§ó‡•Å‡§®‡•Ä", "‡§π‡§∏‡•ç‡§§", "‡§ö‡§ø‡§§‡•ç‡§∞‡§æ", "‡§∏‡•ç‡§µ‡§æ‡§§‡•Ä", "‡§µ‡§ø‡§∂‡§æ‡§ñ‡§æ", "‡§Ö‡§®‡•Å‡§∞‡§æ‡§ß‡§æ", "‡§ú‡•ç‡§Ø‡•á‡§∑‡•ç‡§†‡§æ", "‡§Æ‡•Ç‡§≤", "‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§∑‡§æ‡§¢‡§º‡§æ", "‡§â‡§§‡•ç‡§§‡§∞‡§æ‡§∑‡§æ‡§¢‡§º‡§æ", "‡§∂‡•ç‡§∞‡§µ‡§£", "‡§ß‡§®‡§ø‡§∑‡•ç‡§†‡§æ", "‡§∂‡§§‡§≠‡§ø‡§∑‡§æ", "‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ ‡§≠‡§æ‡§¶‡•ç‡§∞‡§™‡§¶", "‡§â‡§§‡•ç‡§§‡§∞‡§æ ‡§≠‡§æ‡§¶‡•ç‡§∞‡§™‡§¶", "‡§∞‡•á‡§µ‡§§‡•Ä"],
                rashi: ["‚ôà ‡§Æ‡•á‡§∑", "‚ôâ ‡§µ‡•É‡§∑‡§≠", "‚ôä ‡§Æ‡§ø‡§•‡•Å‡§®", "‚ôã ‡§ï‡§∞‡•ç‡§ï", "‚ôå ‡§∏‡§ø‡§Ç‡§π", "‚ôç ‡§ï‡§®‡•ç‡§Ø‡§æ", "‚ôé ‡§§‡•Å‡§≤‡§æ", "‚ôè ‡§µ‡•É‡§∂‡•ç‡§ö‡§ø‡§ï", "‚ôê ‡§ß‡§®‡•Å", "‚ôë ‡§Æ‡§ï‡§∞", "‚ôí ‡§ï‡•Å‡§Ç‡§≠", "‚ôì ‡§Æ‡•Ä‡§®"],
                masaName: ["‡§µ‡•à‡§∂‡§æ‡§ñ", "‡§ú‡•ç‡§Ø‡•á‡§∑‡•ç‡§†", "‡§Ü‡§∑‡§æ‡§¢‡§º", "‡§∂‡•ç‡§∞‡§æ‡§µ‡§£", "‡§≠‡§æ‡§¶‡•ç‡§∞‡§™‡§¶", "‡§Ü‡§∂‡•ç‡§µ‡§ø‡§®", "‡§ï‡§æ‡§∞‡•ç‡§§‡§ø‡§ï", "‡§Æ‡§æ‡§∞‡•ç‡§ó‡§∂‡•Ä‡§∞‡•ç‡§∑", "‡§™‡•å‡§∑", "‡§Æ‡§æ‡§ò", "‡§´‡§æ‡§≤‡•ç‡§ó‡•Å‡§®", "‡§ö‡•à‡§§‡•ç‡§∞"],
                vaara: ["‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞", "‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞", "‡§Æ‡§Ç‡§ó‡§≤‡§µ‡§æ‡§∞", "‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞", "‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞", "‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞", "‡§∂‡§®‡§ø‡§µ‡§æ‡§∞"],
                prahara: ["‡§¶‡§ø‡§® ‡§™‡•ç‡§∞‡§π‡§∞", "‡§∞‡§æ‡§§‡•ç‡§∞‡§ø ‡§™‡•ç‡§∞‡§π‡§∞"],
                eras: { vikram: "‡§µ‡§ø‡§ï‡•ç‡§∞‡§Æ ‡§∏‡§Ç‡§µ‡§§", shaka: "‡§∂‡§ï ‡§∏‡§Ç‡§µ‡§§", bangla: "‡§¨‡§Ç‡§ó‡§æ‡§¨‡•ç‡§¶" }
            },
            bn: {
                labels: { tithi: "üìÖ ‡¶§‡¶ø‡¶•‡¶ø", masa: "üóìÔ∏è ‡¶Æ‡¶æ‡¶∏ (‡¶ö‡¶®‡ßç‡¶¶‡ßç‡¶∞)", rashi: "‚òÄÔ∏è ‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø ‡¶∞‡¶æ‡¶∂‡¶ø", moonRashi: "üåí ‡¶ö‡¶®‡ßç‡¶¶‡ßç‡¶∞ ‡¶∞‡¶æ‡¶∂‡¶ø", vaara: "üìÜ ‡¶¨‡¶æ‡¶∞", paksha: "üåó ‡¶™‡¶ï‡ßç‡¶∑", nakshatra: "‚ú® ‡¶®‡¶ï‡ßç‡¶∑‡¶§‡ßç‡¶∞", prahara: "‚è≥ ‡¶™‡ßç‡¶∞‡¶π‡¶∞" },
                tithi: ["‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶æ", "‡¶ß‡ßÉ‡¶§‡ßÄ‡¶Ø‡¶º‡¶æ", "‡¶§‡ßÉ‡ßç‡¶§‡ßÄ‡¶Ø‡¶º‡¶æ", "‡¶ö‡¶§‡ßÅ‡¶∞‡ßç‡¶•‡ßÄ", "‡¶™‡¶û‡ßç‡¶ö‡¶Æ‡ßÄ", "‡¶∑‡¶∑‡ßç‡¶†‡ßÄ", "‡¶∏‡¶™‡ßç‡¶§‡¶Æ‡ßÄ", "‡¶Ö‡¶∑‡ßç‡¶ü‡¶Æ‡ßÄ", "‡¶®‡¶¨‡¶Æ‡ßÄ", "‡¶¶‡¶∂‡¶Æ‡ßÄ", "‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ", "‡¶¶‡ßç‡¶¨‡¶æ‡¶¶‡¶∂‡ßÄ", "‡¶§‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶¶‡¶∂‡ßÄ", "‡¶ö‡¶§‡ßÅ‡¶∞‡ßç‡¶¶‡¶∂‡ßÄ", "‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡¶ø‡¶Æ‡¶æ", "‡¶Ö‡¶Æ‡¶æ‡¶¨‡¶∏‡ßç‡¶Ø‡¶æ"],
                paksha: ["‡¶∂‡ßÅ‡¶ï‡ßç‡¶≤‡¶™‡¶ï‡ßç‡¶∑", "‡¶ï‡ßÉ‡¶∑‡ßç‡¶£‡¶™‡¶ï‡ßç‡¶∑"],
                nakshatra: ["‡¶Ö‡¶∂‡ßç‡¶¨‡¶ø‡¶®‡ßÄ", "‡¶≠‡¶∞‡¶£‡ßÄ", "‡¶ï‡ßÉ‡¶§‡ßç‡¶§‡¶ø‡¶ï‡¶æ", "‡¶∞‡ßã‡¶π‡¶ø‡¶£‡ßÄ", "‡¶Æ‡ßÉ‡¶ó‡¶∂‡¶ø‡¶∞‡¶æ", "‡¶Ü‡¶∞‡ßç‡¶¶‡ßç‡¶∞‡¶æ", "‡¶™‡ßÅ‡¶®‡¶∞‡ßç‡¶¨‡¶∏‡ßÅ", "‡¶™‡ßÅ‡¶∑‡ßç‡¶Ø‡¶æ", "‡¶Ö‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶æ", "‡¶Æ‡¶ò‡¶æ", "‡¶™‡ßÇ‡¶∞‡ßç‡¶¨ ‡¶´‡¶æ‡¶≤‡ßç‡¶ó‡ßÅ‡¶®‡ßÄ", "‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶´‡¶æ‡¶≤‡ßç‡¶ó‡ßÅ‡¶®‡ßÄ", "‡¶π‡¶∏‡ßç‡¶§", "‡¶ö‡¶ø‡¶§‡ßç‡¶∞‡¶æ", "‡¶∏‡ßç‡¶¨‡¶æ‡¶§‡ßÄ", "‡¶¨‡¶ø‡¶∂‡¶æ‡¶ñ‡¶æ", "‡¶Ö‡¶®‡ßÅ‡¶∞‡¶æ‡¶ß‡¶æ", "‡¶ú‡ßç‡¶Ø‡ßá‡¶∑‡ßç‡¶†‡¶æ", "‡¶Æ‡ßÇ‡¶≤‡¶æ", "‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶∑‡¶æ‡¶¢‡¶º‡¶æ", "‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶æ‡¶∑‡¶æ‡¶¢‡¶º‡¶æ", "‡¶∂‡ßç‡¶∞‡¶¨‡¶£‡¶æ", "‡¶ß‡¶®‡¶ø‡¶∑‡ßç‡¶†‡¶æ", "‡¶∂‡¶§‡¶≠‡¶ø‡¶∑‡¶æ", "‡¶™‡ßÇ‡¶∞‡ßç‡¶¨ ‡¶≠‡¶æ‡¶¶‡ßç‡¶∞‡¶™‡¶¶", "‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶≠‡¶æ‡¶¶‡ßç‡¶∞‡¶™‡¶¶", "‡¶∞‡ßá‡¶¨‡¶§‡ßÄ"],
                rashi: ["‚ôà ‡¶Æ‡ßá‡¶∑", "‚ôâ ‡¶¨‡ßÉ‡¶∑", "‚ôä ‡¶Æ‡¶ø‡¶•‡ßÅ‡¶®", "‚ôã ‡¶ï‡¶∞‡ßç‡¶ï‡¶ü", "‚ôå ‡¶∏‡¶ø‡¶Ç‡¶π", "‚ôç ‡¶ï‡¶®‡ßç‡¶Ø‡¶æ", "‚ôé ‡¶§‡ßÅ‡¶≤‡¶æ", "‚ôè ‡¶¨‡ßÉ‡¶∂‡ßç‡¶ö‡¶ø‡¶ï", "‚ôê ‡¶ß‡¶®‡ßÅ", "‚ôë ‡¶Æ‡¶ï‡¶∞", "‚ôí ‡¶ï‡ßÅ‡¶Æ‡ßç‡¶≠", "‚ôì ‡¶Æ‡ßÄ‡¶®"],
                masaName: ["‡¶¨‡ßà‡¶∂‡¶æ‡¶ñ", "‡¶ú‡ßç‡¶Ø‡ßà‡¶∑‡ßç‡¶†", "‡¶Ü‡¶∑‡¶æ‡¶¢‡¶º", "‡¶∂‡ßç‡¶∞‡¶æ‡¶¨‡¶£", "‡¶≠‡¶æ‡¶¶‡ßç‡¶∞", "‡¶Ü‡¶∂‡ßç‡¶¨‡¶ø‡¶®", "‡¶ï‡¶æ‡¶∞‡ßç‡¶§‡¶ø‡¶ï", "‡¶Ö‡¶ó‡ßç‡¶∞‡¶π‡¶æ‡¶Ø‡¶º‡¶£", "‡¶™‡ßå‡ßÅ‡¶∑", "‡¶Æ‡¶æ‡¶ò", "‡¶´‡¶æ‡¶≤‡ßç‡¶ó‡ßÅ‡¶®", "‡¶ö‡ßà‡¶§‡ßç‡¶∞"],
                vaara: ["‡¶∞‡¶¨‡¶ø‡¶¨‡¶æ‡¶∞", "‡¶∏‡ßã‡¶Æ‡¶¨‡¶æ‡¶∞", "‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤‡¶¨‡¶æ‡¶∞", "‡¶¨‡ßÅ‡¶ß‡¶¨‡¶æ‡¶∞", "‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞", "‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞", "‡¶∂‡¶®‡¶ø‡¶¨‡¶æ‡¶∞"],
                prahara: ["‡¶¶‡¶ø‡¶® ‡¶™‡ßç‡¶∞‡¶π‡¶∞", "‡¶∞‡¶æ‡¶§‡ßç‡¶∞‡¶ø ‡¶™‡ßç‡¶∞‡¶π‡¶∞"],
                eras: { vikram: "‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶∏‡¶Ç‡¶¨‡ßé", shaka: "‡¶∂‡¶ï ‡¶∏‡¶Ç‡¶¨‡ßé", bangla: "‡¶¨‡¶ô‡ßç‡¶ó‡¶æ‡¶¨‡ßç‡¶¶" }
            },
            or: {
                labels: { tithi: "üìÖ ‡¨§‡¨ø‡¨•‡¨ø", masa: "üóìÔ∏è ‡¨Æ‡¨æ‡¨∏ (‡¨ö‡¨®‡≠ç‡¨¶‡≠ç‡¨∞)", rashi: "‚òÄÔ∏è ‡¨∏‡≠Ç‡¨∞‡≠ç‡¨Ø‡≠ç‡≠ü ‡¨∞‡¨æ‡¨∂‡¨ø", moonRashi: "üåí ‡¨ö‡¨®‡≠ç‡¨¶‡≠ç‡¨∞ ‡¨∞‡¨æ‡¨∂‡¨ø", vaara: "üìÜ ‡¨¨‡¨æ‡¨∞", paksha: "üåó ‡¨™‡¨ï‡≠ç‡¨∑", nakshatra: "‚ú® ‡¨®‡¨ï‡≠ç‡¨∑‡¨§‡≠ç‡¨∞", prahara: "‚è≥ ‡¨™‡≠ç‡¨∞‡¨π‡¨∞" },
                tithi: ["‡¨™‡≠ç‡¨∞‡¨•‡¨Æ‡¨æ", "‡¨¶‡≠ç‡≠±‡¨ø‡¨§‡≠Ä‡≠ü‡¨æ", "‡¨§‡≠É‡¨§‡≠Ä‡≠ü‡¨æ", "‡¨ö‡¨§‡≠Å‡¨∞‡≠ç‡¨•‡≠Ä", "‡¨™‡¨û‡≠ç‡¨ö‡¨Æ‡≠Ä", "‡¨∑‡¨∑‡≠ç‡¨†‡≠Ä", "‡¨∏‡¨™‡≠ç‡¨§‡¨Æ‡≠Ä", "‡¨Ö‡¨∑‡≠ç‡¨ü‡¨Æ‡≠Ä", "‡¨®‡¨¨‡¨Æ‡≠Ä", "‡¨¶‡¨∂‡¨Æ‡≠Ä", "‡¨è‡¨ï‡¨æ‡¨¶‡¨∂‡≠Ä", "‡¨¶‡≠ç‡≠±‡¨æ‡¨¶‡¨∂‡≠Ä", "‡¨§‡≠ç‡¨∞‡≠ü‡≠ã‡¨¶‡¨∂‡≠Ä", "‡¨ö‡¨§‡≠Å‡¨∞‡≠ç‡¨¶‡¨∂‡≠Ä", "‡¨™‡≠Ç‡¨∞‡≠ç‡¨£‡≠ç‡¨£‡¨ø‡¨Æ‡¨æ", "‡¨Ö‡¨Æ‡¨æ‡¨¨‡¨æ‡¨∏‡≠ç‡≠ü‡¨æ"],
                paksha: ["‡¨∂‡≠Å‡¨ï‡≠ç‡¨≥ ‡¨™‡¨ï‡≠ç‡¨∑", "‡¨ï‡≠É‡¨∑‡≠ç‡¨£ ‡¨™‡¨ï‡≠ç‡¨∑"],
                nakshatra: ["‡¨Ö‡¨∂‡≠ç‡≠±‡¨ø‡¨®‡≠Ä", "‡¨¶‡≠ç‡≠±‡¨ø‡¨ú‡¨æ (‡¨≠‡¨∞‡¨£‡≠Ä)", "‡¨ï‡≠É‡¨§‡≠ç‡¨§‡¨ø‡¨ï‡¨æ", "‡¨∞‡≠ã‡¨π‡¨ø‡¨£‡≠Ä", "‡¨Æ‡≠É‡¨ó‡¨∂‡¨ø‡¨∞‡¨æ", "‡¨Ü‡¨∞‡≠ç‡¨¶‡≠ç‡¨∞‡¨æ", "‡¨™‡≠Å‡¨®‡¨∞‡≠ç‡¨¨‡¨∏‡≠Å", "‡¨™‡≠Å‡¨∑‡≠ç‡≠ü‡¨æ", "‡¨Ö‡¨∂‡≠ç‡¨≥‡≠á‡¨∑‡¨æ", "‡¨Æ‡¨ò‡¨æ", "‡¨™‡≠Ç‡¨∞‡≠ç‡¨¨‡¨æ ‡¨´‡¨æ‡¨≤‡≠ç‡¨ó‡≠Å‡¨®‡≠Ä", "‡¨â‡¨§‡≠ç‡¨§‡¨∞‡¨æ ‡¨´‡¨æ‡¨≤‡≠ç‡¨ó‡≠Å‡¨®‡≠Ä", "‡¨π‡¨∏‡≠ç‡¨§‡¨æ", "‡¨ö‡¨ø‡¨§‡≠ç‡¨∞‡¨æ", "‡¨∏‡≠ç‡≠±‡¨æ‡¨§‡≠Ä", "‡¨¨‡¨ø‡¨∂‡¨æ‡¨ñ‡¨æ", "‡¨Ö‡¨®‡≠Å‡¨∞‡¨æ‡¨ß", "‡¨ú‡≠ç‡≠ü‡≠á‡¨∑‡≠ç‡¨†‡¨æ", "‡¨Æ‡≠Ç‡¨≥‡¨æ", "‡¨™‡≠Ç‡¨∞‡≠ç‡¨¨‡¨æ‡¨∑‡¨æ‡¨¢‡¨º‡¨æ", "‡¨â‡¨§‡≠ç‡¨§‡¨∞‡¨æ‡¨∑‡¨æ‡¨¢‡¨º‡¨æ", "‡¨∂‡≠ç‡¨∞‡¨¨‡¨£‡¨æ", "‡¨ß‡¨®‡¨ø‡¨∑‡≠ç‡¨†‡¨æ", "‡¨∂‡¨§‡¨≠‡¨ø‡¨∑‡¨æ", "‡¨™‡≠Ç‡¨∞‡≠ç‡¨¨ ‡¨≠‡¨æ‡¨¶‡≠ç‡¨∞‡¨™‡¨¶", "‡¨â‡¨§‡≠ç‡¨§‡¨∞ ‡¨≠‡¨æ‡¨¶‡≠ç‡¨∞‡¨™‡¨¶", "‡¨∞‡≠á‡¨¨‡¨§‡≠Ä"],
                rashi: ["‚ôà ‡¨Æ‡≠á‡¨∑", "‚ôâ ‡¨¨‡≠É‡¨∑", "‚ôä ‡¨Æ‡¨ø‡¨•‡≠Å‡¨®", "‚ôã ‡¨ï‡¨∞‡≠ç‡¨ï‡¨ü", "‚ôå ‡¨∏‡¨ø‡¨Ç‡¨π", "‚ôç ‡¨ï‡¨®‡≠ç‡≠ü‡¨æ", "‚ôé ‡¨§‡≠Å‡¨≥‡¨æ", "‚ôè ‡¨¨‡¨ø‡¨õ‡¨æ", "‚ôê ‡¨ß‡¨®‡≠Å", "‚ôë ‡¨Æ‡¨ï‡¨∞", "‚ôí ‡¨ï‡≠Å‡¨Æ‡≠ç‡¨≠", "‚ôì ‡¨Æ‡≠Ä‡¨®"],
                masaName: ["‡¨¨‡≠à‡¨∂‡¨æ‡¨ñ", "‡¨ú‡≠ç‡≠ü‡≠á‡¨∑‡≠ç‡¨†", "‡¨Ü‡¨∑‡¨æ‡¨¢‡¨º", "‡¨∂‡≠ç‡¨∞‡¨æ‡¨¨‡¨£", "‡¨≠‡¨æ‡¨¶‡≠ç‡¨∞‡¨¨", "‡¨Ü‡¨∂‡≠ç‡≠±‡¨ø‡¨®", "‡¨ï‡¨æ‡¨∞‡≠ç‡¨§‡≠ç‡¨§‡¨ø‡¨ï", "‡¨Æ‡¨æ‡¨∞‡≠ç‡¨ó‡¨∂‡≠Ä‡¨∞‡≠ç‡¨∑", "‡¨™‡≠å‡¨∑", "‡¨Æ‡¨æ‡¨ò", "‡¨´‡¨æ‡¨≤‡≠ç‡¨ó‡≠Å‡¨®", "‡¨ö‡≠à‡¨§‡≠ç‡¨∞"],
                vaara: ["‡¨∞‡¨¨‡¨ø‡¨¨‡¨æ‡¨∞", "‡¨∏‡≠ã‡¨Æ‡¨¨‡¨æ‡¨∞", "‡¨Æ‡¨ô‡≠ç‡¨ó‡¨≥‡¨¨‡¨æ‡¨∞", "‡¨¨‡≠Å‡¨ß‡¨¨‡¨æ‡¨∞", "‡¨ó‡≠Å‡¨∞‡≠Å‡¨¨‡¨æ‡¨∞", "‡¨∂‡≠Å‡¨ï‡≠ç‡¨∞‡¨¨‡¨æ‡¨∞", "‡¨∂‡¨®‡¨ø‡¨¨‡¨æ‡¨∞"],
                prahara: ["‡¨¶‡¨ø‡¨® ‡¨™‡≠ç‡¨∞‡¨π‡¨∞", "‡¨∞‡¨æ‡¨§‡¨ø ‡¨™‡≠ç‡¨∞‡¨π‡¨∞"],
                eras: { vikram: "‡¨¨‡¨ø‡¨ï‡≠ç‡¨∞‡¨Æ ‡¨∏‡¨Æ‡≠ç‡¨¨‡¨§", shaka: "‡¨∂‡¨ï ‡¨∏‡¨Æ‡≠ç‡¨¨‡¨§", bangla: "‡¨¨‡¨ô‡≠ç‡¨ó‡¨æ‡¨¨‡≠ç‡¨¶" }
            },
            te: {
                labels: { tithi: "üìÖ ‡∞§‡∞ø‡∞•‡∞ø", masa: "üóìÔ∏è ‡∞ö‡∞Ç‡∞¶‡±ç‡∞∞ ‡∞Æ‡∞æ‡∞∏‡∞Ç", rashi: "‚òÄÔ∏è ‡∞∏‡±Ç‡∞∞‡±ç‡∞Ø ‡∞∞‡∞æ‡∞∂‡∞ø", moonRashi: "üåí ‡∞ö‡∞Ç‡∞¶‡±ç‡∞∞ ‡∞∞‡∞æ‡∞∂‡∞ø", vaara: "üìÜ ‡∞µ‡∞æ‡∞∞‡∞Ç", paksha: "üåó ‡∞™‡∞ï‡±ç‡∞∑‡∞Ç", nakshatra: "‚ú® ‡∞®‡∞ï‡±ç‡∞∑‡∞§‡±ç‡∞∞‡∞Ç", prahara: "‚è≥ ‡∞™‡±ç‡∞∞‡∞π‡∞∞‡∞Ç" },
                tithi: ["‡∞™‡∞æ‡∞°‡±ç‡∞Ø‡∞Æ‡∞ø", "‡∞µ‡∞ø‡∞¶‡∞ø‡∞Ø", "‡∞§‡∞¶‡∞ø‡∞Ø", "‡∞ö‡∞µ‡∞ø‡∞§‡∞ø", "‡∞™‡∞Ç‡∞ö‡∞Æ‡∞ø", "‡∞∑‡∞∑‡±ç‡∞†‡∞ø", "‡∞∏‡∞™‡±ç‡∞§‡∞Æ‡∞ø", "‡∞Ö‡∞∑‡±ç‡∞ü‡∞Æ‡∞ø", "‡∞®‡∞µ‡∞Æ‡∞ø", "‡∞¶‡∞∂‡∞Æ‡∞ø", "‡∞è‡∞ï‡∞æ‡∞¶‡∞∂‡∞ø", "‡∞¶‡±ç‡∞µ‡∞æ‡∞¶‡∞∂‡∞ø", "‡∞§‡±ç‡∞∞‡∞Ø‡±ã‡∞¶‡∞∂‡∞ø", "‡∞ö‡∞§‡±Å‡∞∞‡±ç‡∞¶‡∞∂‡∞ø", "‡∞™‡±å‡∞∞‡±ç‡∞£‡∞Æ‡∞ø", "‡∞Ö‡∞Æ‡∞æ‡∞µ‡∞æ‡∞∏‡±ç‡∞Ø"],
                paksha: ["‡∞∂‡±Å‡∞ï‡±ç‡∞≤ ‡∞™‡∞ï‡±ç‡∞∑‡∞Ç", "‡∞ï‡±É‡∞∑‡±ç‡∞£ ‡∞™‡∞ï‡±ç‡∞∑‡∞Ç"],
                nakshatra: ["‡∞Ö‡∞∂‡±ç‡∞µ‡∞ø‡∞®‡∞ø", "‡∞≠‡∞∞‡∞£‡∞ø", "‡∞ï‡±É‡∞§‡±ç‡∞§‡∞ø‡∞ï", "‡∞∞‡±ã‡∞π‡∞ø‡∞£‡∞ø", "‡∞Æ‡±É‡∞ó‡∞∂‡∞ø‡∞∞", "‡∞Ü‡∞∞‡±ç‡∞¶‡±ç‡∞∞", "‡∞™‡±Å‡∞®‡∞∞‡±ç‡∞µ‡∞∏‡±Å", "‡∞™‡±Å‡∞∑‡±ç‡∞Ø", "‡∞Ü‡∞∂‡±ç‡∞∞‡±á‡∞∑", "‡∞Æ‡∞ñ", "‡∞™‡±Ç‡∞∞‡±ç‡∞µ ‡∞´‡∞≤‡±ç‡∞ó‡±Å‡∞£‡∞ø", "‡∞â‡∞§‡±ç‡∞§‡∞∞ ‡∞´‡∞≤‡±ç‡∞ó‡±Å‡∞£‡∞ø", "‡∞π‡∞∏‡±ç‡∞§", "‡∞ö‡∞ø‡∞§‡±ç‡∞§", "‡∞∏‡±ç‡∞µ‡∞æ‡∞§‡∞ø", "‡∞µ‡∞ø‡∞∂‡∞æ‡∞ñ", "‡∞Ö‡∞®‡±Ç‡∞∞‡∞æ‡∞ß", "jyƒì·π£·π≠ha", "‡∞Æ‡±Ç‡∞≤", "‡∞™‡±Ç‡∞∞‡±ç‡∞µ‡∞æ‡∞∑‡∞æ‡∞¢", "‡∞â‡∞§‡±ç‡∞§‡∞∞‡∞æ‡∞∑‡∞æ‡∞¢", "‡∞∂‡±ç‡∞∞‡∞µ‡∞£‡∞Ç", "‡∞ß‡∞®‡∞ø‡∞∑‡±ç‡∞†", "‡∞∂‡∞§‡∞≠‡∞ø‡∞∑‡∞Ç", "‡∞™‡±Ç‡∞∞‡±ç‡∞µ‡∞æ‡∞≠‡∞æ‡∞¶‡±ç‡∞∞", "‡∞â‡∞§‡±ç‡∞§‡∞∞‡∞æ‡∞≠‡∞æ‡∞¶‡±ç‡∞∞", "‡∞∞‡±á‡∞µ‡∞§‡∞ø"],
                rashi: ["‚ôà ‡∞Æ‡±á‡∞∑‡∞Ç", "‚ôâ ‡∞µ‡±É‡∞∑‡∞≠‡∞Ç", "‚ôä ‡∞Æ‡∞ø‡∞•‡±Å‡∞®‡∞Ç", "‚ôã ‡∞ï‡∞∞‡±ç‡∞ï‡∞æ‡∞ü‡∞ï‡∞Ç", "‚ôå ‡∞∏‡∞ø‡∞Ç‡∞π‡∞Ç", "‚ôç ‡∞ï‡∞®‡±ç‡∞Ø‡∞æ", "‚ôé ‡∞§‡±Å‡∞≤‡∞æ", "‚ôè ‡∞µ‡±É‡∞∂‡±ç‡∞ö‡∞ø‡∞ï‡∞Ç", "‚ôê ‡∞ß‡∞®‡±Å‡∞∏‡±ç‡∞∏‡±Å", "‚ôë ‡∞Æ‡∞ï‡∞∞‡∞Ç", "‚ôí ‡∞ï‡±Å‡∞Ç‡∞≠‡∞Ç", "‚ôì ‡∞Æ‡±Ä‡∞®‡∞Ç"],
                masaName: ["‡∞µ‡±à‡∞∂‡∞æ‡∞ñ‡∞Ç", "‡∞ú‡±ç‡∞Ø‡±á‡∞∑‡±ç‡∞†‡∞Ç", "‡∞Ü‡∞∑‡∞æ‡∞¢‡∞Ç", "‡∞∂‡±ç‡∞∞‡∞æ‡∞µ‡∞£‡∞Ç", "‡∞≠‡∞æ‡∞¶‡±ç‡∞∞‡∞™‡∞¶‡∞Ç", "‡∞Ü‡∞∂‡±ç‡∞µ‡∞Ø‡±Å‡∞ú‡∞Ç", "‡∞ï‡∞æ‡∞∞‡±ç‡∞§‡±Ä‡∞ï‡∞Ç", "‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞∂‡∞ø‡∞∞‡∞Ç", "‡∞™‡±Å‡∞∑‡±ç‡∞Ø‡∞Ç", "‡∞Æ‡∞æ‡∞ò‡∞Ç", "‡∞´‡∞æ‡∞≤‡±ç‡∞ó‡±Å‡∞£‡∞Ç", "‡∞ö‡±à‡∞§‡±ç‡∞∞‡∞Ç"],
                vaara: ["‡∞Ü‡∞¶‡∞ø‡∞µ‡∞æ‡∞∞‡∞Ç", "‡∞∏‡±ã‡∞Æ‡∞µ‡∞æ‡∞∞‡∞Ç", "‡∞Æ‡∞Ç‡∞ó‡∞≥‡∞µ‡∞æ‡∞∞‡∞Ç", "‡∞¨‡±Å‡∞ß‡∞µ‡∞æ‡∞∞‡∞Ç", "‡∞ó‡±Å‡∞∞‡±Å‡∞µ‡∞æ‡∞∞‡∞Ç", "‡∞∂‡±Å‡∞ï‡±ç‡∞∞‡∞µ‡∞æ‡∞∞‡∞Ç", "‡∞∂‡∞®‡∞ø‡∞µ‡∞æ‡∞∞‡∞Ç"],
                prahara: ["‡∞™‡∞ó‡∞≤‡±Å ‡∞™‡±ç‡∞∞‡∞π‡∞∞", "‡∞∞‡∞æ‡∞§‡±ç‡∞∞‡∞ø ‡∞™‡±ç‡∞∞‡∞π‡∞∞"],
                eras: { vikram: "‡∞µ‡∞ø‡∞ï‡±ç‡∞∞‡∞Æ‡±ç ‡∞∏‡∞Ç‡∞µ‡∞§‡±ç", shaka: "‡∞∂‡∞ï ‡∞∏‡∞Ç‡∞µ‡∞§‡±ç", bangla: "‡∞¨‡∞Ç‡∞ó‡∞æ‡∞¨‡±ç‡∞¶‡∞Ç" }
            }
        };

        // --- HELPER FUNCTIONS ---
        function getAyanamsa(t) {
            const year = t.date.getFullYear();
            return 24.1 + (year - 2000) * 0.014;
        }

        function getAngleDiff(a, b) {
            let d = a - b;
            while (d <= -180) d += 360;
            while (d > 180) d -= 360;
            return d;
        }

        function updatePlanetaryPositions(date) {
            document.getElementById('planetary-data').classList.remove('hidden');
            const data = VEDIC_TRANSLATIONS[currentLang] || VEDIC_TRANSLATIONS['en'];
            const container = document.getElementById('planet-list');
            container.innerHTML = '';

            const time = Astronomy.MakeTime(date);
            const prevTime = time.AddDays(-1 / 24); // 1 hour back
            const ayanamsa = getAyanamsa(time);

            // Western Sign Names (Fixed)
            const westernSigns = ["Aries", "Taurus", "Gemini", "Cancer", "Leo", "Virgo", "Libra", "Scorpio", "Sagittarius", "Capricorn", "Aquarius", "Pisces"];

            // 1. Calculate positions and group by Sign
            // Map 0..11 -> Array of planets
            const planetsInSign = {};
            for (let i = 0; i < 12; i++) planetsInSign[i] = [];

            const bodies = [
                { name: 'Sun', key: Astronomy.Body.Sun, icon: '‚òÄÔ∏è' },
                { name: 'Moon', key: Astronomy.Body.Moon, icon: 'üåô' },
                { name: 'Mercury', key: Astronomy.Body.Mercury, icon: '‚òøÔ∏è' },
                { name: 'Venus', key: Astronomy.Body.Venus, icon: '‚ôÄÔ∏è' },
                { name: 'Mars', key: Astronomy.Body.Mars, icon: '‚ôÇÔ∏è' },
                { name: 'Jupiter', key: Astronomy.Body.Jupiter, icon: '‚ôÉ' },
                { name: 'Saturn', key: Astronomy.Body.Saturn, icon: '‚ôÑ' },
                { name: 'Uranus', key: Astronomy.Body.Uranus, icon: '‚ôÖ' },
                { name: 'Neptune', key: Astronomy.Body.Neptune, icon: '‚ôÜ' }
            ];

            bodies.forEach(body => {
                let lon, prevLon;
                try {
                    let getLon = (t) => {
                        if (body.key === Astronomy.Body.Sun) {
                            try { return Astronomy.EclipticLongitude(body.key, t); }
                            catch (e) { return Astronomy.SunPosition(t).elon; }
                        }
                        return Astronomy.EclipticLongitude(body.key, t);
                    };
                    lon = getLon(time);
                    prevLon = getLon(prevTime);
                } catch (e) { return; }

                // Speed calculation for retrograde
                let diff = lon - prevLon;
                if (diff < -180) diff += 360;
                if (diff > 180) diff -= 360;
                const isRetrograde = diff < 0;

                let siderealLon = lon - ayanamsa;
                if (siderealLon < 0) siderealLon += 360;

                const rashiIndex = Math.floor(siderealLon / 30) % 12;
                const degreeInSign = siderealLon % 30;

                // Get Nakshatra
                const nakDuration = 360 / 27;
                const nakIndex = Math.floor(siderealLon / nakDuration);
                const nakName = data.nakshatra[nakIndex] || "";

                planetsInSign[rashiIndex].push({
                    ...body,
                    degree: degreeInSign,
                    nakshatra: nakName,
                    isRetrograde
                });
            });

            // 2. Build Grid HTML
            const gridDiv = document.createElement('div');
            gridDiv.className = 'chart-grid';

            // Center Text
            const centerDiv = document.createElement('div');
            centerDiv.className = 'chart-center';
            centerDiv.innerHTML = "<div>Rashi Chart</div>";
            gridDiv.appendChild(centerDiv);

            // 12 Signs
            for (let i = 0; i < 12; i++) {
                const cell = document.createElement('div');
                cell.className = `chart-cell sign-${i}`;

                // Get Vedic Label
                let rashiStr = data.rashi[i];
                let rashiSymbol = rashiStr.split(' ')[0]; // ‚ôà
                let rashiName = rashiStr.split(' ').slice(1).join(' '); // Mesha

                cell.innerHTML = `
                    <div class="chart-cell-label" style="flex-direction:column; align-items:center; gap:2px; margin-bottom: 6px;">
                        <span style="font-size:0.75rem; text-transform:uppercase; color:#fff; letter-spacing:0.5px;">${westernSigns[i]}</span>
                        <span style="font-size:0.7rem; color:#94a3b8;">${rashiName} (${rashiSymbol})</span>
                    </div>
                    <div class="chart-planets" style="margin-top:2px;"></div>
                `;

                const pContainer = cell.querySelector('.chart-planets');

                planetsInSign[i].forEach(p => {
                    const pSpan = document.createElement('span');
                    pSpan.className = 'planet-icon tooltip-container';

                    // Display: Name + Icon
                    // Highlight Retrograde visually? Maybe italic or specific color? kept simple as requested.
                    const retroMark = p.isRetrograde ? '<span style="color:#f87171; font-size:0.7rem; margin-left:2px;">(R)</span>' : '';

                    pSpan.innerHTML = `<span style="color:#38bdf8; font-weight:500;">${p.name}</span> <span style="font-size:1.1rem;">${p.icon}</span>${retroMark}`;
                    pSpan.style.justifyContent = "space-between";
                    pSpan.style.width = "100%";
                    pSpan.style.padding = "2px 4px";
                    pSpan.style.background = "#0f172a";
                    pSpan.style.borderRadius = "4px";

                    // Tooltip content
                    let motionStr = p.isRetrograde ? "Retrograde ‚Ü∫" : "Direct ‚Üª";
                    let tip = `Pos: ${p.degree.toFixed(2)}¬∞\nNakshatra: ${p.nakshatra}\nMotion: ${motionStr}`;

                    pSpan.setAttribute('data-tip', tip);
                    pSpan.style.cursor = 'help';
                    pContainer.appendChild(pSpan);
                });

                gridDiv.appendChild(cell);
            }

            container.appendChild(gridDiv);

            // Add Legend/Note
            const note = document.createElement('div');
            note.style.fontSize = '0.75rem';
            note.style.color = '#64748b';
            note.style.marginTop = '0.5rem';
            note.style.textAlign = 'center';
            note.innerText = "Hover over planets for exact degrees and motion.";
            container.appendChild(note);
        }

        function updateVedicDetails(date, lat, lng) {
            document.getElementById('vedic-data').classList.remove('hidden');
            const data = VEDIC_TRANSLATIONS[currentLang] || VEDIC_TRANSLATIONS['en'];

            // Update labels
            if (data.labels) {
                document.getElementById('label-tithi').innerText = data.labels.tithi;
                document.getElementById('label-masa').innerText = data.labels.masa;
                document.getElementById('label-sun-rashi').innerText = data.labels.rashi;
                document.getElementById('label-moon-rashi').innerText = data.labels.moonRashi;
                document.getElementById('label-vaara').innerText = data.labels.vaara;
                document.getElementById('label-paksha').innerText = data.labels.paksha;
                document.getElementById('label-nakshatra').innerText = data.labels.nakshatra;
                document.getElementById('label-prahara').innerText = data.labels.prahara;
            }

            try {
                // 0. Prepare AstroTime
                const time = Astronomy.MakeTime(date);

                // --- HELPER FOR FINDING END TIME ---
                function formatTime(dateObj, forceDate = true) {
                    // Always show date if forceDate is true, or if not today.
                    // User requested "Every range should have a date time".
                    const today = date.toDateString() === dateObj.toDateString();
                    const hrs = dateObj.getHours().toString().padStart(2, '0');
                    const mins = dateObj.getMinutes().toString().padStart(2, '0');
                    const dayStr = (forceDate || !today) ? `${dateObj.getDate()}/${dateObj.getMonth() + 1} ` : "";
                    return `${dayStr}${hrs}:${mins}`;
                }

                function findCrossingEfficient(startT, currentVal, targetVal, ratePerDay, callback) {
                    // Estimate delta time: rate is degrees/day.
                    // deltaAngle = current - target. (If +ve, we passed it, need to go back).
                    // t_event ~= startT - (deltaAngle / ratePerDay)
                    const deltaAngle = getAngleDiff(currentVal, targetVal);
                    const daysOffset = deltaAngle / ratePerDay;
                    const estimatedT = startT.AddDays(-daysOffset);

                    // Search in a narrow window around estimate (e.g., +/- 0.6 days to be safe)
                    // This avoids finding the 'previous cycle' root 30 days ago.
                    const t1 = estimatedT.AddDays(-0.7);
                    const t2 = estimatedT.AddDays(0.7);

                    const event = Astronomy.Search(callback, t1, t2);
                    if (event) return event.date;
                    // Fallback to estimation if search fails (rare, close enough)
                    return estimatedT.date;
                }



                // --- DATE HEADER ---
                const currentYear = date.getFullYear();
                const shakaYear = currentYear - 78; // Approx
                const vikramYear = currentYear + 57; // Approx
                const banglaYear = currentYear - 593; // Approx

                let dateHeaderStr = `${data.eras.vikram} ${vikramYear} | ${data.eras.shaka} ${shakaYear}`;
                if (currentLang === 'bn') dateHeaderStr = `${data.eras.bangla} ${banglaYear} | ${data.eras.shaka} ${shakaYear}`;
                if (currentLang === 'or') dateHeaderStr = `${data.eras.shaka} ${shakaYear} | ${data.eras.vikram} ${vikramYear}`;

                document.getElementById('vedic-date-header').innerText = dateHeaderStr;

                // 1. Tithi
                let sunLon;
                try { sunLon = Astronomy.EclipticLongitude(Astronomy.Body.Sun, time); }
                catch (e) { sunLon = Astronomy.SunPosition(time).elon; }
                const moonLon = Astronomy.EclipticLongitude(Astronomy.Body.Moon, time);

                let diff = moonLon - sunLon;
                if (diff < 0) diff += 360;

                const tithiNum = Math.floor(diff / 12) + 1;
                const isShukla = tithiNum <= 15;
                const paksha = isShukla ? data.paksha[0] : data.paksha[1];

                // Progress
                // Tithi matches (diff/12). 12 deg spans. diff % 12 is amount into current tithi.
                const tithiProgress = ((diff % 12) / 12) * 100;
                document.getElementById('progress-tithi').style.width = `${tithiProgress}%`;

                let tithiNameIndex = (tithiNum - 1) % 15;
                let tithiName = data.tithi[tithiNameIndex];

                let tithiIcon = isShukla ? "üåí" : "üåò";
                if (tithiNum === 15) { tithiName = data.tithi[14]; tithiIcon = "üåï"; } // Purnima
                else if (tithiNum === 30) { tithiName = data.tithi[15]; tithiIcon = "üåë"; } // Amavasya

                const tithiTip = "Tithi is the timestamp of the 12¬∞ angular step. Purnima (15th Tithi) starts at 168¬∞, covering the final phase before the exact Full Moon (180¬∞).";
                document.getElementById('vedic-tithi').innerText = `${tithiIcon} ${tithiName}`;
                document.getElementById('vedic-tithi').setAttribute('data-tip', tithiTip);

                document.getElementById('vedic-paksha').innerText = paksha;

                // Paksha Progress (approx)
                // Shukla: Tithi 1-15. Krishna: Tithi 16-30.
                const pakshaProgress = ((tithiNum - 1 + (tithiProgress / 100)) % 15) / 15 * 100;
                document.getElementById('progress-paksha').style.width = `${pakshaProgress}%`;

                // Calc Tithi Start & End
                const targetDiffStart = (tithiNum - 1) * 12.0;
                const targetDiffEnd = tithiNum * 12.0;

                const tithiCallback = (target) => (t) => {
                    let s; try { s = Astronomy.EclipticLongitude(Astronomy.Body.Sun, t); } catch (e) { s = Astronomy.SunPosition(t).elon; }
                    const m = Astronomy.EclipticLongitude(Astronomy.Body.Moon, t);
                    let currentDiff = m - s;
                    if (currentDiff < 0) currentDiff += 360;
                    return getAngleDiff(currentDiff, target);
                };

                // Rate: ~12.19 deg/day
                const TITHI_RATE = 12.1907;
                // currentVal for Tithi is 'diff' (Moon-Sun)
                const tStart = findCrossingEfficient(time, diff, targetDiffStart, TITHI_RATE, tithiCallback(targetDiffStart));
                const tEnd = findCrossingEfficient(time, diff, targetDiffEnd, TITHI_RATE, tithiCallback(targetDiffEnd));

                let tRange = "--";
                if (tStart && tEnd) tRange = `${formatTime(tStart)} - ${formatTime(tEnd)}`;
                else if (tEnd) tRange = `Ends: ${formatTime(tEnd)}`;
                document.getElementById('vedic-tithi-end').innerText = tRange;

                // Paksha Start/End
                const pakshaStartDiff = isShukla ? 0 : 180;
                const pakshaEndDiff = isShukla ? 180 : 0;

                // Paksha is 15 days roughly. But efficient finder works locally.
                // We need to be careful. Paksha start might be 14 days ago.
                // 'diff' is currently e.g. 170 (Shukla Chaturdashi). Target 0.
                // delta = 170. daysOffset = 170/12.19 ~= 14 days. 
                // Efficient finder handles this perfectly!
                const pStart = findCrossingEfficient(time, diff, pakshaStartDiff, TITHI_RATE, tithiCallback(pakshaStartDiff));
                const pEnd = findCrossingEfficient(time, diff, pakshaEndDiff, TITHI_RATE, tithiCallback(pakshaEndDiff));

                if (pStart && pEnd) document.getElementById('vedic-paksha-end').innerText = `${formatTime(pStart)} - ${formatTime(pEnd)}`;
                else if (pEnd) document.getElementById('vedic-paksha-end').innerText = `Ends: ${formatTime(pEnd)}`;

                // 2. Nakshatra
                let siderealLon = moonLon - getAyanamsa(time);
                if (siderealLon < 0) siderealLon += 360;

                const nakshatraDuration = 360 / 27;
                const nakshatraIndex = Math.floor(siderealLon / nakshatraDuration);

                const nakProgress = ((siderealLon % nakshatraDuration) / nakshatraDuration) * 100;
                document.getElementById('progress-nakshatra').style.width = `${nakProgress}%`;

                const nData = NAKSHATRA_DATA[nakshatraIndex];
                let nStr = `‚ú® ${data.nakshatra[nakshatraIndex] || "Unknown"}`;
                let nTip = `Nakshatra is defined by Moon's position in 27 sectors (13¬∞20' each). Changes approx every 1 day.`;
                if (nData) {
                    nStr += ` (${nData.star})`;
                    nTip += `\nStar: ${nData.star}\nConstellation: ${nData.con}\nMag: ${nData.mag}, Dist: ${nData.dist}`;
                }
                document.getElementById('vedic-nakshatra').setAttribute('data-tip', nTip);
                document.getElementById('vedic-nakshatra').innerText = nStr;

                // Nakshatra Ends
                const nakStartLon = nakshatraIndex * nakshatraDuration;
                const nakEndLon = (nakshatraIndex + 1) * nakshatraDuration;

                const nakCallback = (target) => (t) => {
                    const m = Astronomy.EclipticLongitude(Astronomy.Body.Moon, t);
                    const ay = getAyanamsa(t);
                    let sd = m - ay;
                    if (sd < 0) sd += 360;
                    return getAngleDiff(sd, target);
                };

                const MOON_Rate = 13.176; // deg/day
                const nStart = findCrossingEfficient(time, siderealLon, nakStartLon, MOON_Rate, nakCallback(nakStartLon));
                const nEnd = findCrossingEfficient(time, siderealLon, nakEndLon, MOON_Rate, nakCallback(nakEndLon));

                let nRange = "--";
                if (nStart && nEnd) nRange = `${formatTime(nStart)} - ${formatTime(nEnd)}`;
                else if (nEnd) nRange = `Ends: ${formatTime(nEnd)}`;
                document.getElementById('vedic-nakshatra-end').innerText = nRange;

                // 3. Rashi (Moon & Sun) and Masa
                const moonRashiIndex = Math.floor(siderealLon / 30);
                document.getElementById('vedic-moon-rashi').innerText = data.rashi[moonRashiIndex];

                // Moon Rashi Progress
                const moonRashiProgress = ((siderealLon % 30) / 30) * 100;
                document.getElementById('progress-moon-rashi').style.width = `${moonRashiProgress}%`;

                // Moon Rashi End
                const rashiCallback = (target) => (t) => {
                    const m = Astronomy.EclipticLongitude(Astronomy.Body.Moon, t);
                    const ay = getAyanamsa(t);
                    let sd = m - ay;
                    if (sd < 0) sd += 360;
                    return getAngleDiff(sd, target);
                };
                const mrStartLon = moonRashiIndex * 30;
                const mrEndLon = (moonRashiIndex + 1) * 30;

                const mrStart = findCrossingEfficient(time, siderealLon, mrStartLon, MOON_Rate, rashiCallback(mrStartLon));
                const mrEnd = findCrossingEfficient(time, siderealLon, mrEndLon, MOON_Rate, rashiCallback(mrEndLon));

                const rashiTip = "Chandra Rashi is the Moon Sign, defined by Moon's position in 30¬∞ sectors. Changes approx every 2.5 days.";
                document.getElementById('vedic-moon-rashi').setAttribute('data-tip', rashiTip);

                let mrRange = "--";
                if (mrStart && mrEnd) mrRange = `${formatTime(mrStart)} - ${formatTime(mrEnd)}`;
                else if (mrEnd) mrRange = `Ends: ${formatTime(mrEnd)}`;
                document.getElementById('vedic-moon-rashi-end').innerText = mrRange;

                // Sun Rashi & Masa (Approx)
                let sunSidereal = sunLon - getAyanamsa(time);
                if (sunSidereal < 0) sunSidereal += 360;
                const rashiIndex = Math.floor(sunSidereal / 30);

                document.getElementById('vedic-sun-rashi').innerText = data.rashi[rashiIndex];
                document.getElementById('vedic-masa').innerText = data.masaName[rashiIndex];

                // Sun Rashi Progress
                const sunRashiProgress = ((sunSidereal % 30) / 30) * 100;
                document.getElementById('progress-sun-rashi').style.width = `${sunRashiProgress}%`;

                // Masa Progress (Approx Sun progress in Rashi)
                document.getElementById('progress-masa').style.width = `${sunRashiProgress}%`;

                // Sun Rashi Start/End
                const srCallback = (target) => (t) => {
                    let s; try { s = Astronomy.EclipticLongitude(Astronomy.Body.Sun, t); } catch (e) { s = Astronomy.SunPosition(t).elon; }
                    const ay = getAyanamsa(t);
                    let sd = s - ay;
                    if (sd < 0) sd += 360;
                    return getAngleDiff(sd, target);
                }
                const sunStartLon = rashiIndex * 30;
                const sunEndLon = (rashiIndex + 1) * 30;

                const SUN_RATE = 0.9856; // deg/day

                const sStart = findCrossingEfficient(time, sunSidereal, sunStartLon, SUN_RATE, srCallback(sunStartLon));
                const sEnd = findCrossingEfficient(time, sunSidereal, sunEndLon, SUN_RATE, srCallback(sunEndLon));

                if (sStart && sEnd) {
                    // Use forceDate=true (default)
                    const str = `${formatTime(sStart)} - ${formatTime(sEnd)}`;
                    document.getElementById('vedic-sun-rashi-end').innerText = str;
                    document.getElementById('vedic-masa-end').innerText = str;
                } else if (sEnd) {
                    const str = `Ends: ${formatTime(sEnd)}`;
                    document.getElementById('vedic-sun-rashi-end').innerText = str;
                    document.getElementById('vedic-masa-end').innerText = str;
                }

                // 4. Vaara
                const obs = new Astronomy.Observer(lat, lng, 0);
                const prevRise = Astronomy.SearchRiseSet(Astronomy.Body.Sun, obs, +1, time, -1);
                let dayIndex = date.getDay();
                if (prevRise) dayIndex = prevRise.date.getDay();
                document.getElementById('vedic-vaara').innerText = data.vaara[dayIndex];

                // Vaara End (Next Sunrise)
                const nextSunrise = Astronomy.SearchRiseSet(Astronomy.Body.Sun, obs, +1, time, +1);
                if (nextSunrise) {
                    // Get Prev Sunrise for Start
                    const sunStart = prevRise ? formatTime(prevRise.date) : "--";
                    const sunEnd = formatTime(nextSunrise.date);
                    document.getElementById('vedic-vaara-end').innerText = `${sunStart} - ${sunEnd}`;

                    // Vaara Progress
                    if (prevRise) {
                        const dayTotal = nextSunrise.date - prevRise.date;
                        const dayElapsed = date - prevRise.date;
                        const vProg = (dayElapsed / dayTotal) * 100;
                        document.getElementById('progress-vaara').style.width = `${vProg}%`;
                    }
                }

                // 5. Prahara
                const nextRise = Astronomy.SearchRiseSet(Astronomy.Body.Sun, obs, +1, time, +1);
                const nextSet = Astronomy.SearchRiseSet(Astronomy.Body.Sun, obs, -1, time, +1);

                let praharaStr = "--";
                let praharaEnd = "";

                if (nextRise && nextSet) {
                    if (nextSet.date < nextRise.date) {
                        // Day Time
                        const currentRise = prevRise || Astronomy.SearchRiseSet(Astronomy.Body.Sun, obs, +1, time, -1);
                        if (currentRise) {
                            const dayLen = nextSet.date - currentRise.date;
                            const elapsed = date - currentRise.date;
                            const p = Math.floor(elapsed / (dayLen / 4)) + 1;
                            if (p <= 4) {
                                praharaStr = `${data.prahara[0]} ${p}/4`;
                                // Progress
                                const praharaDuration = dayLen / 4;
                                const praharaElapsed = elapsed - ((p - 1) * praharaDuration);
                                const pProg = (praharaElapsed / praharaDuration) * 100;
                                document.getElementById('progress-prahara').style.width = `${pProg}%`;
                            }
                            // Prahara End Time
                            const endP = new Date(currentRise.date.getTime() + (p * dayLen / 4));
                            const startP = new Date(currentRise.date.getTime() + ((p - 1) * dayLen / 4));
                            praharaEnd = `${formatTime(startP)} - ${formatTime(endP)}`;
                        }
                    } else {
                        // Night Time
                        const prevSet = Astronomy.SearchRiseSet(Astronomy.Body.Sun, obs, -1, time, -1);
                        if (prevSet) {
                            const nightLen = nextRise.date - prevSet.date;
                            const elapsed = date - prevSet.date;
                            const p = Math.floor(elapsed / (nightLen / 4)) + 1;
                            if (p <= 4) {
                                praharaStr = `${data.prahara[1]} ${p}/4`;
                                const praharaDuration = nightLen / 4;
                                const praharaElapsed = elapsed - ((p - 1) * praharaDuration);
                                const pProg = (praharaElapsed / praharaDuration) * 100;
                                document.getElementById('progress-prahara').style.width = `${pProg}%`;
                            }
                            const endP = new Date(prevSet.date.getTime() + (p * nightLen / 4));
                            const startP = new Date(prevSet.date.getTime() + ((p - 1) * nightLen / 4));
                            praharaEnd = `${formatTime(startP)} - ${formatTime(endP)}`;
                        }
                    }
                }
                document.getElementById('vedic-prahara').innerText = praharaStr;
                document.getElementById('vedic-prahara-end').innerText = praharaEnd;
            } catch (e) {
                console.error("Vedic calc error:", e);
                // document.getElementById('vedic-prahara').innerText = "Calc Error";
            }
        }

        function updateExternalLinks(lat, lng) {
            const container = document.getElementById('skymap-container');
            // Clean up existing iframes
            container.innerHTML = '';

            const iframe = document.createElement('iframe');
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.border = 'none';

            // Build VirtualSky URL
            // Docs: https://lco.global/virtualsky/
            const baseUrl = "https://virtualsky.lco.global/embed/index.html";
            const params = new URLSearchParams({
                longitude: lng,
                latitude: lat,
                projection: 'stereo',
                constellations: 'true',
                constellationlabels: 'true',
                showstarlabels: 'true',
                showplanets: 'true',
                showplanetlabels: 'true',
                showdate: 'false', // We show date elsewhere
                showposition: 'false',
                live: 'true', // Auto update time
                az: 180, // Facing South by default
                background: 'rgba(0,0,0,0)', // Transparent to blend with our dark theme? Or just dark.
                // Actually transparent might be hard to read on some backgrounds, lets use a dark hex
                // VirtualSky background param takes css color.
                // Our card is #1e293b. Lets match it or go slightly darker.
                color: 'white',
            });

            iframe.src = `${baseUrl}?${params.toString()}`;
            container.appendChild(iframe);

            // Update Heavens-Above Link as well
            const haLink = document.getElementById('ha-link');
            // Calculate Heavens-Above timezone parameter
            // Format: UCT[m]H[colonM]
            const offset = new Date().getTimezoneOffset();

            let tzParam = 'UCT';
            if (offset !== 0) {
                if (offset < 0) tzParam += 'm';
                const absOffset = Math.abs(offset);
                const hours = Math.floor(absOffset / 60);
                const mins = absOffset % 60;
                tzParam += hours;
                if (mins > 0) tzParam += 'colon' + mins;
            }

            const haUrl = `https://heavens-above.com/main.aspx?lat=${lat}&lng=${lng}&loc=Unnamed&alt=0&tz=${tzParam}`;
            haLink.href = haUrl;
            haLink.innerText = `View Sky Chart on Heavens-Above (Lat: ${lat.toFixed(2)}, Lng: ${lng.toFixed(2)})`;
        }

        function error(err) {
            console.warn(`ERROR(${err.code}): ${err.message}. Falling back to default location.`);
            // Fallback to New Delhi
            success({
                coords: {
                    latitude: 28.6139,
                    longitude: 77.2090
                }
            });
        }

        function showError(msg) {
            errorMsg.innerText = msg;
            errorMsg.classList.remove('hidden');
        }

        async function fetchLocationName(lat, lng) {
            const nameEl = document.getElementById('location-name');
            nameEl.innerText = "Locating city...";

            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=10&addressdetails=1`);
                const data = await response.json();

                if (data && data.address) {
                    const city = data.address.city || data.address.town || data.address.village || data.address.hamlet || data.address.county;
                    const country = data.address.country;
                    nameEl.innerText = city ? `${city}, ${country}` : data.display_name.split(',')[0];
                } else {
                    nameEl.innerText = "Unknown Location";
                }
            } catch (e) {
                console.error("Reverse geocoding failed", e);
                nameEl.innerText = "";
            }
        }

        function updateSolarLunarCycles(date, lat, lng) {
            const obs = new Astronomy.Observer(lat, lng, 0);

            const formatTimeShort = (d) => {
                const now = new Date();
                const isToday = d.toDateString() === now.toDateString();
                const h = d.getHours().toString().padStart(2, '0');
                const m = d.getMinutes().toString().padStart(2, '0');
                return isToday ? `${h}:${m}` : `${d.getDate()}/${d.getMonth() + 1} ${h}:${m}`;
            };
            const formatRange = (start, end) => `${formatTimeShort(start)} - ${formatTimeShort(end)}`;

            // Generic function to process Sun/Moon
            const processBody = (body, labelPrefix, idPrefix) => {
                // Search up to 2 days forward/backward
                const nextRise = Astronomy.SearchRiseSet(body, obs, +1, date, 2);
                const nextSet = Astronomy.SearchRiseSet(body, obs, -1, date, 2);
                const prevRise = Astronomy.SearchRiseSet(body, obs, +1, date, -2);
                const prevSet = Astronomy.SearchRiseSet(body, obs, -1, date, -2);

                if (!nextRise || !nextSet || !prevRise || !prevSet) {
                    // Polar region or body strictly below/above horizon?
                    document.getElementById(`${idPrefix}-cycle-range`).innerText = "No Event / Polar";
                    return;
                }

                // Determine state
                // If next Set is sooner than next Rise, we are currently UP (Day/Moon Up).
                const isUp = nextSet.date < nextRise.date;

                let nextEventLabel, nextEventTime, start, end;

                if (isUp) {
                    // Current: Up. Next: Set.
                    nextEventLabel = "Sunset";
                    if (labelPrefix === "Moon") nextEventLabel = "Moonset";
                    nextEventTime = nextSet.date;
                    // Start of this range: The Rise that happened previously
                    start = prevRise.date;
                    end = nextSet.date;
                } else {
                    // Current: Down. Next: Rise.
                    nextEventLabel = "Sunrise";
                    if (labelPrefix === "Moon") nextEventLabel = "Moonrise";
                    nextEventTime = nextRise.date;
                    // Start of this range: The Set that happened previously
                    start = prevSet.date;
                    end = nextRise.date;
                }

                // Icon
                let icon = "";
                if (labelPrefix === "Sun") icon = isUp ? "üåá" : "üåÖ";
                if (labelPrefix === "Moon") icon = isUp ? "üìâ" : "üìà";

                document.getElementById(`label-${idPrefix}-cycle`).innerText = `${icon} Next ${nextEventLabel}`;
                document.getElementById(`${idPrefix}-next-event-time`).innerText = formatTimeShort(nextEventTime);
                document.getElementById(`${idPrefix}-cycle-range`).innerText = formatRange(start, end);

                const total = end - start;
                const elapsed = date - start;
                const progress = (elapsed / total) * 100;
                document.getElementById(`progress-${idPrefix}`).style.width = `${Math.min(100, Math.max(0, progress))}%`;
            };

            processBody(Astronomy.Body.Sun, "Sun", "sun");
            processBody(Astronomy.Body.Moon, "Moon", "moon");

            // --- 3. Moon Phase ---
            const phase = Astronomy.MoonPhase(date); // 0..360
            const phaseName = getMoonPhaseName(phase);
            document.getElementById('moon-phase-name').innerText = phaseName;

            const phaseProgress = (phase / 360) * 100;
            document.getElementById('progress-phase').style.width = `${phaseProgress}%`;

            // Range: Last New Moon ... Next New Moon
            let lastNew = Astronomy.SearchMoonPhase(0, date, -45);
            // Fallback if negative search behaves oddly or returns null (should support but check)
            if (!lastNew) {
                let d = new Date(date.getTime() - 45 * 86400000);
                let best = null;
                for (let i = 0; i < 3; i++) {
                    const m = Astronomy.SearchMoonPhase(0, d, 45);
                    if (m && m.date < date) {
                        best = m;
                        d = new Date(m.date.getTime() + 1000);
                    } else break;
                }
                lastNew = best;
            }

            const nextNew = Astronomy.SearchMoonPhase(0, date, 45);

            if (lastNew && nextNew) {
                document.getElementById('moon-phase-range').innerText = `${formatTimeShort(lastNew.date)} - ${formatTimeShort(nextNew.date)}`;
            }
        }

        function getRelativeTime(targetDate) {
            const now = new Date();
            const diffMs = targetDate - now;
            const diffSec = Math.floor(diffMs / 1000);
            const absSec = Math.abs(diffSec);

            const isFuture = diffSec > 0;
            const prefix = isFuture ? 'in ' : '';
            const suffix = isFuture ? '' : ' ago';

            if (absSec < 60) return "now";
            if (absSec < 3600) {
                const mins = Math.floor(absSec / 60);
                return `${prefix}${mins}m${suffix}`;
            }
            if (absSec < 86400) {
                const hours = Math.floor(absSec / 3600);
                const mins = Math.floor((absSec % 3600) / 60);
                // e.g. "2h 30m ago"
                return `${prefix}${hours}h ${mins}m${suffix}`;
            }
            // Days
            const days = Math.floor(absSec / 86400);
            const hours = Math.floor((absSec % 86400) / 3600);
            return `${prefix}${days}d ${hours}h${suffix}`;
        }

        function getMoonPhaseName(degrees) {
            if (degrees < 10 || degrees > 350) return "New Moon üåë";
            if (degrees < 80) return "Waxing Crescent üåí";
            if (degrees < 100) return "First Quarter üåì";
            if (degrees < 170) return "Waxing Gibbous üåî";
            if (degrees < 190) return "Full Moon üåï";
            if (degrees < 260) return "Waning Gibbous üåñ";
            if (degrees < 280) return "Last Quarter üåó";
            return "Waning Crescent üåò";
        }



    </script>
</body>

</html>